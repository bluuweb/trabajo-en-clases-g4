<h1>Ruta protegida</h1>

<div id="app">
    Loading data
</div>

<script>
    const app = document.getElementById('app')

    const pintarDatos = (users) => {
        app.innerHTML = ''
        users.forEach(user => {
            app.innerHTML += `
            <div class="alert alert-primary">${user.email}</div>
            `
        })
    }

    document.addEventListener('DOMContentLoaded', async() => {

        if(!localStorage.getItem('token')){
            window.location.href = "/login"
        }
        
        try {

            const res = await fetch('/api/v1/users', {
                method: 'get',
                headers: {
                    Authorization: `Bearer ${localStorage.getItem('token')}`
                }
            })

            const data = await res.json()
            console.log(data)
            if(!data.ok){
                window.location.href = "/login"
            }

            pintarDatos(data.users)

        }catch(e){
            console.log(e)
        }

    })
    

</script>